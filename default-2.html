<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pacman Game</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #gameContainer {
            position: relative;
        }

        #gameBoard {
            display: grid;
            grid-template-columns: repeat(19, 25px);
            grid-template-rows: repeat(21, 25px);
            gap: 1px;
            background: #000;
            border: 2px solid #00f;
        }

        .cell {
            width: 25px;
            height: 25px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .wall {
            background: #00f;
        }

        .empty {
            background: #000;
        }

        .dot {
            background: #000;
        }

            .dot::after {
                content: '';
                width: 4px;
                height: 4px;
                background: #ff0;
                border-radius: 50%;
                position: absolute;
            }

        .pacman {
            background: #ff0;
            border-radius: 50%;
            position: relative;
        }

            .pacman::before {
                content: '';
                position: absolute;
                width: 0;
                height: 0;
                border: 8px solid #000;
                border-radius: 0 8px 8px 0;
                top: 4px;
                right: 4px;
            }

        .ghost {
            border-radius: 50% 50% 0 0;
            position: relative;
        }

            .ghost.red {
                background: #f00;
            }

            .ghost.blue {
                background: #00f;
            }

            .ghost.green {
                background: #0f0;
            }

            .ghost::after {
                content: '';
                position: absolute;
                bottom: -1px;
                left: 0;
                right: 0;
                height: 8px;
                background: inherit;
                clip-path: polygon(0 0, 20% 100%, 40% 0, 60% 100%, 80% 0, 100% 100%, 100% 0);
            }

        #score {
            font-size: 24px;
            margin-bottom: 10px;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border: 2px solid #fff;
            text-align: center;
            display: none;
        }

        #gameWin {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 100, 0, 0.9);
            padding: 30px;
            border: 2px solid #fff;
            text-align: center;
            display: none;
        }

        button {
            background: #00f;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

            button:hover {
                background: #44f;
            }

        #instructions {
            margin-top: 20px;
            text-align: center;
            max-width: 500px;
        }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <div id="gameContainer">
        <div id="gameBoard"></div>
        <div id="gameOver">
            <h2>You Died!</h2>
            <button onclick="restartGame()">Retry?</button>
        </div>
        <div id="gameWin">
            <h2>You Win!</h2>
            <p>Congratulations! You ate all the dots!</p>
            <button onclick="restartGame()">Play Again?</button>
        </div>
    </div>
    <div id="instructions">
        <p>Use WASD or Arrow Keys to move Pacman</p>
        <p>Avoid the ghosts and eat all the dots to win!</p>
    </div>

    <script>
        const ROWS = 21;
        const COLS = 19;
        let score = 0;
        let gameRunning = true;
        let totalDots = 0;
        let dotsEaten = 0;

        // Game board layout (1 = wall, 0 = empty with dot)
        const maze = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,0,1],
            [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
            [1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,0,1],
            [1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1],
            [1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,1],
            [0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0],
            [1,1,1,1,0,1,0,1,0,0,0,1,0,1,0,1,1,1,1],
            [0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0],
            [1,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,1],
            [0,0,0,1,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0],
            [1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,1],
            [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
            [0,1,1,0,1,0,1,1,1,1,1,1,0,1,0,1,1,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,0],
            [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];

        // Game entities
        let pacman = { x: 9, y: 17 };
        let ghosts = [
            { x: 8, y: 9, color: 'red' },
            { x: 9, y: 9, color: 'blue' },
            { x: 10, y: 9, color: 'green' }
        ];

        // Store original dots
        let dots = [];

        function initGame() {
            const gameBoard = document.getElementById('gameBoard');
            gameBoard.innerHTML = '';
            dots = [];
            totalDots = 0;
            dotsEaten = 0;
            score = 0;
            gameRunning = true;

            // Reset positions
            pacman = { x: 9, y: 17 };
            ghosts = [
                { x: 8, y: 9, color: 'red' },
                { x: 9, y: 9, color: 'blue' },
                { x: 10, y: 9, color: 'green' }
            ];

            // Create board
            for (let y = 0; y < ROWS; y++) {
                for (let x = 0; x < COLS; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${x}-${y}`;

                    if (maze[y] && maze[y][x] === 1) {
                        cell.classList.add('wall');
                    } else {
                        cell.classList.add('empty');
                        // Add dot if not a ghost starting position
                        if (!(x >= 8 && x <= 10 && y === 9) && !(x === 9 && y === 17)) {
                            cell.classList.add('dot');
                            dots.push({ x, y });
                            totalDots++;
                        }
                    }

                    gameBoard.appendChild(cell);
                }
            }

            updateDisplay();
            updateScore();
        }

        function updateDisplay() {
            // Clear all entities
            document.querySelectorAll('.pacman, .ghost').forEach(el => {
                el.classList.remove('pacman', 'ghost', 'red', 'blue', 'green');
            });

            // Place Pacman
            const pacmanCell = document.getElementById(`cell-${pacman.x}-${pacman.y}`);
            if (pacmanCell) {
                pacmanCell.classList.add('pacman');
            }

            // Place ghosts
            ghosts.forEach(ghost => {
                const ghostCell = document.getElementById(`cell-${ghost.x}-${ghost.y}`);
                if (ghostCell) {
                    ghostCell.classList.add('ghost', ghost.color);
                }
            });
        }

        function updateScore() {
            document.getElementById('score').textContent = `Score: ${score}`;
        }

        function isValidMove(x, y) {
            return x >= 0 && x < COLS && y >= 0 && y < ROWS &&
                   (!maze[y] || maze[y][x] !== 1);
        }

        function isGhostAt(x, y) {
            return ghosts.some(ghost => ghost.x === x && ghost.y === y);
        }

        function movePacman(dx, dy) {
            if (!gameRunning) return;

            const newX = pacman.x + dx;
            const newY = pacman.y + dy;

            if (isValidMove(newX, newY)) {
                pacman.x = newX;
                pacman.y = newY;

                // Check if pacman ate a dot
                const dotIndex = dots.findIndex(dot => dot.x === pacman.x && dot.y === pacman.y);
                if (dotIndex !== -1) {
                    dots.splice(dotIndex, 1);
                    dotsEaten++;
                    score += 10;
                    updateScore();

                    // Remove dot from display
                    const cell = document.getElementById(`cell-${pacman.x}-${pacman.y}`);
                    cell.classList.remove('dot');

                    // Check win condition
                    if (dotsEaten === totalDots) {
                        gameRunning = false;
                        document.getElementById('gameWin').style.display = 'block';
                        return;
                    }
                }

                // Check collision with ghosts
                if (ghosts.some(ghost => ghost.x === pacman.x && ghost.y === pacman.y)) {
                    gameOver();
                    return;
                }

                updateDisplay();
            }
        }

        function moveGhosts() {
            if (!gameRunning) return;

            ghosts.forEach(ghost => {
                // Calculate direction to pacman
                const dx = pacman.x - ghost.x;
                const dy = pacman.y - ghost.y;

                let moves = [];

                // Prioritize moves towards pacman
                if (Math.abs(dx) > Math.abs(dy)) {
                    if (dx > 0) moves.push({ x: 1, y: 0 });
                    else moves.push({ x: -1, y: 0 });
                    if (dy > 0) moves.push({ x: 0, y: 1 });
                    else moves.push({ x: 0, y: -1 });
                } else {
                    if (dy > 0) moves.push({ x: 0, y: 1 });
                    else moves.push({ x: 0, y: -1 });
                    if (dx > 0) moves.push({ x: 1, y: 0 });
                    else moves.push({ x: -1, y: 0 });
                }

                // Add remaining directions
                const allMoves = [
                    { x: 0, y: -1 }, { x: 1, y: 0 },
                    { x: 0, y: 1 }, { x: -1, y: 0 }
                ];

                allMoves.forEach(move => {
                    if (!moves.some(m => m.x === move.x && m.y === move.y)) {
                        moves.push(move);
                    }
                });

                // Try moves in order
                let moved = false;
                for (let move of moves) {
                    const newX = ghost.x + move.x;
                    const newY = ghost.y + move.y;

                    if (isValidMove(newX, newY) && !isGhostAt(newX, newY)) {
                        ghost.x = newX;
                        ghost.y = newY;
                        moved = true;
                        break;
                    }
                }

                // If no valid move found, try random direction
                if (!moved) {
                    const randomMoves = allMoves.sort(() => Math.random() - 0.5);
                    for (let move of randomMoves) {
                        const newX = ghost.x + move.x;
                        const newY = ghost.y + move.y;

                        if (isValidMove(newX, newY) && !isGhostAt(newX, newY)) {
                            ghost.x = newX;
                            ghost.y = newY;
                            break;
                        }
                    }
                }
            });

            // Check collision after ghost movement
            if (ghosts.some(ghost => ghost.x === pacman.x && ghost.y === pacman.y)) {
                gameOver();
                return;
            }

            updateDisplay();
        }

        function gameOver() {
            gameRunning = false;
            document.getElementById('gameOver').style.display = 'block';
        }

        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('gameWin').style.display = 'none';
            initGame();
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;

            switch(e.key.toLowerCase()) {
                case 'w':
                case 'arrowup':
                    e.preventDefault();
                    movePacman(0, -1);
                    break;
                case 's':
                case 'arrowdown':
                    e.preventDefault();
                    movePacman(0, 1);
                    break;
                case 'a':
                case 'arrowleft':
                    e.preventDefault();
                    movePacman(-1, 0);
                    break;
                case 'd':
                case 'arrowright':
                    e.preventDefault();
                    movePacman(1, 0);
                    break;
            }
        });

        // Ghost movement timer
        setInterval(moveGhosts, 1000);

        // Initialize game
        initGame();
    </script>
</body>
</html>